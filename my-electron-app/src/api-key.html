<!DOCTYPE html>
<html>
<head>
  <title>API Key 设置</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #api-key-area {
      margin-bottom: 20px;
    }
    #api-key-input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    #shortcut-select {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    #config-path {
      margin-top: 10px;
      font-size: 14px;
      color: #555;
    }
    #test-result {
      margin-top: 10px;
      color: green;
    }
    #current-api-key {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>设置界面</h1>
  <div id="api-key-area">
    <textarea id="api-key-input" placeholder="输入 DeepSeek API Key"></textarea>
    <button id="set-api-key-button">设置 API Key</button>
    <button id="test-api-button">测试 API</button>
    <select id="shortcut-select">
      <option value="CommandOrControl+Alt+A">Ctrl + Alt + A</option>
      <option value="CommandOrControl+Alt+E">Ctrl + Alt + E</option>
    </select>
    <div id="test-result"></div>
    <div id="current-api-key">当前 API Key: <span id="api-key-display">无</span></div>
    <div id="config-path">配置文件路径: <span id="config-path-display"></span></div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');
    let apiKey = '';

    ipcRenderer.on('load-api-key', (event, key, shortcut, configPath) => {
      apiKey = key;
      const input = document.getElementById('api-key-input');
      input.value = apiKey;
      updateApiKeyDisplay();

      // 设置下拉框的选中值
      const shortcutSelect = document.getElementById('shortcut-select');
      shortcutSelect.value = shortcut;

      // 显示配置文件路径
      const configPathDisplay = document.getElementById('config-path-display');
      configPathDisplay.textContent = configPath;
    });

    function updateApiKeyDisplay() {
      const displayElement = document.getElementById('api-key-display');
      displayElement.textContent = apiKey.trim() !== '' ? apiKey : '无';
    }

    document.getElementById('set-api-key-button').addEventListener('click', function() {
      apiKey = document.getElementById('api-key-input').value;
      if (apiKey.trim() !== '') {
        alert('API Key 设置成功！');
        ipcRenderer.send('set-api-key', apiKey);
      } else {
        alert('请输入有效的 API Key。');
      }
      updateApiKeyDisplay();
    });

    document.getElementById('shortcut-select').addEventListener('change', function() {
      const shortcut = this.value;
      alert('快捷键设置成功！');
      ipcRenderer.send('set-shortcut', shortcut);
    });

    document.getElementById('test-api-button').addEventListener('click', async function() {
      if (apiKey.trim() !== '') {
        try {
          const response = await fetch('https://api.deepseek.com/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${apiKey}`
            },
            body: JSON.stringify({
              model: 'deepseek-chat',
              messages: [
                { role: 'system', content: '测试消息。' }
              ],
              stream: false
            })
          });

          if (response.ok) {
            document.getElementById('test-result').textContent = 'API 调用成功！';
          } else {
            document.getElementById('test-result').textContent = 'API 调用失败。';
          }
        } catch (error) {
          document.getElementById('test-result').textContent = '调用 API 时出错。';
          console.error('Error calling DeepSeek API:', error);
        }
      } else {
        alert('请设置您的 API Key。');
      }
    });

    // Initialize display
    updateApiKeyDisplay();
  </script>
</body>
</html> 